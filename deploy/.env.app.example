# =============================================================================
# FluxCode Multi-Host - App Env (Caddy + FluxCode)
# =============================================================================
# 用途：配合 deploy/docker-compose.app.yml 使用（应用/入口服务器）。
# 复制为 .env 后修改：
#   cp .env.app.example .env
#
# 说明：
# - DATABASE_HOST / REDIS_HOST 指向“数据库/缓存服务器”的内网 IP 或域名
# - JWT_SECRET / ADMIN_PASSWORD 在所有应用节点必须一致（方便后续扩容）
# =============================================================================

# -----------------------------------------------------------------------------
# Image
# -----------------------------------------------------------------------------
# 你可以改为自己的镜像，例如：duegin/fluxcode:latest 或 fluxcode:latest（本地构建）
FLUXCODE_IMAGE=duegin/fluxcode:latest

# -----------------------------------------------------------------------------
# Ingress (Caddy)
# -----------------------------------------------------------------------------
BIND_HOST=0.0.0.0

# 对外端口（默认域名访问：80/443）
HTTP_PORT=80
HTTPS_PORT=443

# 域名（推荐）：设置为你的域名，例如 flux-code.cc
# 留空则仅提供 HTTP（默认监听 :80，不会自动签发 HTTPS 证书）
CADDY_ADDRESS=flux-code.cc

# 可选：自定义 sticky cookie 的 HMAC secret（防止用户伪造 cookie 选择上游）
# 建议生成：openssl rand -hex 32
CADDY_LB_COOKIE_SECRET=

# -----------------------------------------------------------------------------
# FluxCode Server
# -----------------------------------------------------------------------------
SERVER_MODE=release
WEB_TITLE=FluxCode
RUN_MODE=standard
TZ=Asia/Shanghai

# -----------------------------------------------------------------------------
# PostgreSQL (remote)
# -----------------------------------------------------------------------------
# 数据库服务器地址（内网 IP/域名）
DATABASE_HOST=10.0.0.10
DATABASE_PORT=5432
DATABASE_SSLMODE=disable

POSTGRES_USER=fluxcode
POSTGRES_PASSWORD=change_this_secure_password
POSTGRES_DB=fluxcode

# -----------------------------------------------------------------------------
# Redis (remote)
# -----------------------------------------------------------------------------
REDIS_HOST=10.0.0.10
REDIS_PORT=6379
REDIS_PASSWORD=change_this_secure_redis_password
REDIS_DB=0

# -----------------------------------------------------------------------------
# Admin Account (REQUIRED)
# -----------------------------------------------------------------------------
ADMIN_EMAIL=admin@fluxcode.local
ADMIN_PASSWORD=change_this_admin_password

# -----------------------------------------------------------------------------
# JWT (REQUIRED)
# -----------------------------------------------------------------------------
# 建议生成：openssl rand -hex 32
JWT_SECRET=change_this_jwt_secret
JWT_EXPIRE_HOUR=24

# -----------------------------------------------------------------------------
# Connection Pool Tuning (optional)
# -----------------------------------------------------------------------------
# 多实例时建议下调单实例连接池（2c2g 通常不用太大）
DATABASE_MAX_OPEN_CONNS=10
DATABASE_MAX_IDLE_CONNS=5
REDIS_POOL_SIZE=64
REDIS_MIN_IDLE_CONNS=10
